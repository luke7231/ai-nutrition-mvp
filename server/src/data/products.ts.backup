export interface Product {
  id: string;
  brand: string;
  name: string;
  ingredientId: string; // 주요 성분 ID (호환성 유지)
  ingredient: string; // 주요 성분명
  // 복수 성분 지원 (종합 비타민 등)
  ingredientIds?: string[]; // 포함된 모든 성분 ID 배열
  dailyDosage: number; // 주요 성분의 일일 섭취량
  // 각 성분별 함량 (종합 비타민의 경우)
  dosages?: Record<string, number>; // { "vitaminB": 50, "vitaminC": 500, ... }
  tags: string[];
  image_url: string;
  price: number;
  pillSize: string;
  pillsPerDay: number;
  intakeTime: "morning" | "evening" | "both";
  features: string[];
  essential?: boolean; // light 전략에서 필수 제품 여부
}

// 성분별 제품 생성 템플릿
const ingredientTemplates: Record<
  string,
  {
    name: string;
    unit: string;
    dosageRanges: { min: number; max: number; step: number }[];
    intakeTime: "morning" | "evening" | "both";
    pillSizes: string[];
    featuresPool: string[];
  }
> = {
  silymarin: {
    name: "밀크씨슬",
    unit: "mg",
    dosageRanges: [
      { min: 300, max: 420, step: 30 },
      { min: 420, max: 600, step: 40 },
      { min: 600, max: 800, step: 50 },
    ],
    intakeTime: "morning",
    pillSizes: ["500원 동전 크기", "중간 정제", "큰 정제"],
    featuresPool: [
      "GMP 인증 시설에서 생산",
      "실리마린 표준화 추출물 사용",
      "간 건강 기능성 인정 원료",
      "유기농 인증",
      "고함량 실리마린 함유",
    ],
  },
  omega3: {
    name: "오메가3",
    unit: "mg",
    dosageRanges: [
      { min: 500, max: 800, step: 100 },
      { min: 800, max: 1200, step: 100 },
      { min: 1200, max: 2000, step: 200 },
    ],
    intakeTime: "evening",
    pillSizes: ["작은 캡슐형", "중간 캡슐", "소프트젤"],
    featuresPool: [
      "고농축 EPA+DHA 함유",
      "오메가3 TG형 사용",
      "비린내 없는 장용성 코팅",
      "어유 정제 기술 적용",
      "심혈관 건강 기능성 인정",
    ],
  },
  glucosamine: {
    name: "글루코사민",
    unit: "mg",
    dosageRanges: [
      { min: 1000, max: 1500, step: 100 },
      { min: 1500, max: 2000, step: 150 },
      { min: 2000, max: 2500, step: 200 },
    ],
    intakeTime: "both",
    pillSizes: ["중간 정제", "큰 정제", "캡슐형"],
    featuresPool: [
      "글루코사민 HCl 고함량",
      "MSM 복합 배합",
      "관절 건강 기능성 인정",
      "콘드로이틴 함유",
      "저분자 흡수율 향상",
    ],
  },
  coq10: {
    name: "코엔자임 Q10",
    unit: "mg",
    dosageRanges: [
      { min: 50, max: 100, step: 10 },
      { min: 100, max: 200, step: 20 },
      { min: 200, max: 300, step: 30 },
    ],
    intakeTime: "morning",
    pillSizes: ["소프트젤", "작은 캡슐", "중간 캡슐"],
    featuresPool: [
      "유비퀴놀 활성형",
      "흡수율 향상 기술 적용",
      "항산화 기능성 인정",
      "미토콘드리아 지원",
      "에너지 생성 촉진",
    ],
  },
  magnesium: {
    name: "마그네슘",
    unit: "mg",
    dosageRanges: [
      { min: 200, max: 300, step: 25 },
      { min: 300, max: 400, step: 30 },
      { min: 400, max: 500, step: 50 },
    ],
    intakeTime: "evening",
    pillSizes: ["작은 정제", "중간 정제", "캡슐형"],
    featuresPool: [
      "고흡수율 마그네슘 시트레이트",
      "수면 개선 기능성 인정",
      "근육 이완 지원",
      "스트레스 완화",
      "칼슘과의 균형 조절",
    ],
  },
  calcium: {
    name: "칼슘",
    unit: "mg",
    dosageRanges: [
      { min: 300, max: 600, step: 50 },
      { min: 600, max: 1000, step: 50 },
      { min: 1000, max: 1500, step: 100 },
    ],
    intakeTime: "evening",
    pillSizes: ["큰 정제", "중간 정제", "캡슐형"],
    featuresPool: [
      "구연산 칼슘 사용",
      "흡수율 개선 포뮬라",
      "뼈 건강 기능성 인정",
      "비타민D와 시너지",
      "마그네슘 복합 배합",
    ],
  },
  vitaminB: {
    name: "비타민B 복합체",
    unit: "mg",
    dosageRanges: [
      { min: 50, max: 100, step: 10 },
      { min: 100, max: 150, step: 15 },
      { min: 150, max: 200, step: 20 },
    ],
    intakeTime: "morning",
    pillSizes: ["작은 정제", "중간 정제", "큰 정제"],
    featuresPool: [
      "B1, B2, B6, B12 복합",
      "에너지 대사 지원",
      "신경 건강 기능성 인정",
      "피로 회복 촉진",
      "고함량 활성형",
    ],
  },
  vitaminC: {
    name: "비타민C",
    unit: "mg",
    dosageRanges: [
      { min: 500, max: 1000, step: 100 },
      { min: 1000, max: 1500, step: 150 },
      { min: 1500, max: 2000, step: 200 },
    ],
    intakeTime: "both",
    pillSizes: ["작은 정제", "큰 정제", "캡슐형"],
    featuresPool: [
      "천연 비타민C 추출",
      "면역력 강화 기능성 인정",
      "항산화 작용",
      "콜라겐 합성 지원",
      "지속 방출 기술",
    ],
  },
  vitaminD: {
    name: "비타민D3",
    unit: "IU",
    dosageRanges: [
      { min: 1000, max: 2000, step: 200 },
      { min: 2000, max: 3000, step: 300 },
      { min: 3000, max: 5000, step: 500 },
    ],
    intakeTime: "morning",
    pillSizes: ["작은 캡슐", "소프트젤", "중간 캡슐"],
    featuresPool: [
      "D3 활성형 사용",
      "칼슘 흡수 촉진",
      "골 건강 기능성 인정",
      "면역력 지원",
      "고함량 D3",
    ],
  },
  probiotics: {
    name: "프로바이오틱스",
    unit: "CFU",
    dosageRanges: [
      { min: 10, max: 50, step: 10 },
      { min: 50, max: 100, step: 15 },
      { min: 100, max: 200, step: 25 },
    ],
    intakeTime: "morning",
    pillSizes: ["작은 캡슐", "중간 캡슐", "소프트젤"],
    featuresPool: [
      "다양한 균주 함유",
      "장 건강 기능성 인정",
      "면역력 향상",
      "소화 개선",
      "장용성 코팅",
    ],
  },
  lutein: {
    name: "루테인",
    unit: "mg",
    dosageRanges: [
      { min: 10, max: 20, step: 2 },
      { min: 20, max: 30, step: 3 },
      { min: 30, max: 40, step: 5 },
    ],
    intakeTime: "both",
    pillSizes: ["작은 캡슐", "중간 캡슐", "소프트젤"],
    featuresPool: [
      "제아잔틴 복합",
      "눈 건강 기능성 인정",
      "황반변성 예방",
      "고함량 추출물",
      "항산화 작용",
    ],
  },
  zinc: {
    name: "아연",
    unit: "mg",
    dosageRanges: [
      { min: 10, max: 15, step: 1 },
      { min: 15, max: 20, step: 2 },
      { min: 20, max: 30, step: 3 },
    ],
    intakeTime: "both",
    pillSizes: ["작은 정제", "중간 정제", "캡슐형"],
    featuresPool: [
      "고흡수율 아연 피콜리네이트",
      "면역력 강화 기능성 인정",
      "상처 치유 촉진",
      "항산화 지원",
      "피부 건강 개선",
    ],
  },
  iron: {
    name: "철분",
    unit: "mg",
    dosageRanges: [
      { min: 10, max: 15, step: 1 },
      { min: 15, max: 20, step: 2 },
      { min: 20, max: 30, step: 3 },
    ],
    intakeTime: "evening",
    pillSizes: ["작은 정제", "중간 정제", "캡슐형"],
    featuresPool: [
      "비헤마 철분 사용",
      "빈혈 예방 기능성 인정",
      "위장 자극 최소화",
      "철분 흡수 촉진",
      "임산부 안전",
    ],
  },
  collagen: {
    name: "콜라겐",
    unit: "mg",
    dosageRanges: [
      { min: 3000, max: 5000, step: 500 },
      { min: 5000, max: 7000, step: 500 },
      { min: 7000, max: 10000, step: 1000 },
    ],
    intakeTime: "both",
    pillSizes: ["큰 정제", "캡슐형", "파우더형"],
    featuresPool: [
      "해양 콜라겐 펩타이드",
      "피부 건강 기능성 인정",
      "관절 건강 지원",
      "고분해 저분자",
      "흡수율 향상",
    ],
  },
};

// 브랜드 목록 (가격대별 분포)
const brands = {
  budget: [
    "NatureMade",
    "Cenovis",
    "Doctor's Best",
    "California Gold",
    "Now Foods",
  ],
  standard: ["Solgar", "Jarrow", "GNC", "Nature's Way", "Rainbow Light"],
  premium: [
    "Life Extension",
    "Thorne Research",
    "Pure Encapsulations",
    "Metagenics",
    "Designs for Health",
  ],
};

// 증상 태그 풀 (symptoms.ts와 겹치게)
const symptomTags = [
  "피로 회복",
  "근육 건강",
  "눈 건강",
  "숙취 해소",
  "스트레스 완화",
  "피부 건강",
  "다이어트",
  "변비 개선",
  "월경 전 증후군",
  "만성 피로",
  "간 건강",
  "탈모 관리",
  "체력 증진",
  "콜레스테롤",
  "항산화",
  "피부 보습",
  "체지방 감소",
  "임신 준비",
  "빈혈 예방",
  "혈압 관리",
  "전립선 건강",
  "눈 침침함",
  "체력 저하",
  "복부 비만",
  "갱년기 초기",
  "골밀도",
  "혈행 개선",
  "탄력 저하",
  "우울감",
  "전립선 비대",
  "관절 통증",
  "기억력 감퇴",
  "심혈관 건강",
  "면역력",
  "갱년기 장애",
  "골다공증 예방",
  "관절 건강",
  "수면 장애",
  "안면 홍조",
  "기력 저하",
  "치매 예방",
  "청력 보호",
  "배뇨 장애",
  "근감소증",
  "퇴행성 관절염",
  "뇌 건강",
  "요실금",
  "노화 방지",
  "종합 비타민",
  "에너지",
  "남성 활력",
  "지구력",
  "혈행 개선",
  "두뇌 건강",
  "심혈관",
  "수면 개선",
  "근육 이완",
  "장 건강",
  "소화 개선",
  "남성",
  "배뇨 개선",
  "항염",
  "항산화",
];

// 성분별 관련 태그 매핑
export const ingredientTagMap: Record<string, string[]> = {
  silymarin: ["간 건강", "항산화", "피로 회복", "숙취 해소"],
  omega3: ["혈행 개선", "두뇌 건강", "심혈관 건강", "항산화", "콜레스테롤"],
  glucosamine: ["관절 통증", "관절 건강", "퇴행성 관절염", "근육 건강"],
  coq10: ["에너지", "항산화", "심혈관 건강", "피로 회복", "기력 저하"],
  magnesium: ["수면 개선", "근육 이완", "스트레스 완화", "우울감", "수면 장애"],
  calcium: ["골밀도", "골다공증 예방", "칼슘 흡수", "근육 이완", "근육 건강"],
  vitaminB: ["피로 회복", "만성 피로", "에너지", "신경 건강", "스트레스 완화"],
  vitaminC: ["면역력", "항산화", "피부 건강", "피부 보습", "노화 방지"],
  vitaminD: ["골밀도", "골다공증 예방", "면역력", "칼슘 흡수"],
  vitaminA: ["눈 건강", "면역력", "야맹증", "피부 건강", "항산화"],
  probiotics: ["장 건강", "면역력", "소화 개선", "변비 개선"],
  lutein: ["눈 건강", "눈 침침함", "황반변성", "항산화"],
  zinc: ["면역력", "피부 건강", "상처 치유", "탈모 관리"],
  iron: ["빈혈 예방", "철분 보충", "임신 준비", "에너지"],
  collagen: ["피부 건강", "피부 보습", "관절 건강", "탄력 저하", "노화 방지"],
};

function generateProduct(
  ingredientId: string,
  index: number,
  priceTier: "budget" | "standard" | "premium"
): Product {
  const template = ingredientTemplates[ingredientId];
  if (!template) {
    throw new Error(`Unknown ingredient: ${ingredientId}`);
  }

  // 가격대별 브랜드 선택
  const brandList = brands[priceTier];
  const brand = brandList[index % brandList.length];

  // 가격대별 가격 범위
  const priceRanges = {
    budget: { min: 12000, max: 28000 },
    standard: { min: 25000, max: 45000 },
    premium: { min: 40000, max: 65000 },
  };
  const priceRange = priceRanges[priceTier];
  const price = Math.floor(
    priceRange.min + Math.random() * (priceRange.max - priceRange.min)
  );

  // 용량 선택 (가격대에 따라 다른 범위)
  const dosageRangeIndex =
    priceTier === "budget" ? 0 : priceTier === "standard" ? 1 : 2;
  const dosageRange = template.dosageRanges[dosageRangeIndex];
  const dailyDosage = Math.floor(
    dosageRange.min + Math.random() * (dosageRange.max - dosageRange.min)
  );

  // 알약 크기 및 개수
  const pillSize = template.pillSizes[index % template.pillSizes.length];
  const pillsPerDay = priceTier === "premium" ? 1 : Math.random() > 0.5 ? 2 : 3;

  // 특징 3개 랜덤 선택
  const shuffledFeatures = [...template.featuresPool].sort(
    () => Math.random() - 0.5
  );
  const features = shuffledFeatures.slice(0, 3);

  // 태그 생성 (성분별 기본 태그 + 증상 태그 2-3개)
  const baseTags = ingredientTagMap[ingredientId] || [];
  const shuffledSymptomTags = [...symptomTags].sort(() => Math.random() - 0.5);
  const additionalTags = shuffledSymptomTags
    .filter((tag) => !baseTags.includes(tag))
    .slice(0, Math.floor(2 + Math.random() * 2));
  const tags = [...baseTags, ...additionalTags];

  // 제품명 생성
  const nameVariants = [
    `${template.name} ${
      priceTier === "premium"
        ? "프리미엄"
        : priceTier === "standard"
        ? "스탠다드"
        : "베이직"
    }`,
    `${template.name} ${dailyDosage}${template.unit}`,
    `${brand} ${template.name}`,
    `고함량 ${template.name}`,
    `${template.name} 엑스트라`,
  ];
  const name = nameVariants[index % nameVariants.length];

  return {
    id: `${ingredientId}_${priceTier}_${index}`,
    brand,
    name,
    ingredientId,
    ingredient: template.name,
    dailyDosage,
    tags,
    image_url: `https://via.placeholder.com/150?text=${encodeURIComponent(
      template.name
    )}`,
    price,
    pillSize,
    pillsPerDay,
    intakeTime: template.intakeTime,
    features,
    essential:
      priceTier === "budget" || (priceTier === "standard" && index % 2 === 0),
  };
}

// 100개 제품 생성
export const products: Product[] = [];

const ingredientIds = Object.keys(ingredientTemplates);
const productsPerIngredient = Math.floor(100 / ingredientIds.length);
const remainder = 100 % ingredientIds.length;

ingredientIds.forEach((ingredientId, idx) => {
  const count = productsPerIngredient + (idx < remainder ? 1 : 0);

  // 각 성분별로 budget/standard/premium 균등 분배
  const tierCounts = {
    budget: Math.ceil(count / 3),
    standard: Math.ceil(count / 3),
    premium: count - Math.ceil(count / 3) * 2,
  };

  let productIndex = 0;
  ["budget", "standard", "premium"].forEach((tier) => {
    for (let i = 0; i < tierCounts[tier as keyof typeof tierCounts]; i++) {
      products.push(
        generateProduct(
          ingredientId,
          productIndex,
          tier as "budget" | "standard" | "premium"
        )
      );
      productIndex++;
    }
  });
});

// 정확히 100개로 맞추기
while (products.length > 100) {
  products.pop();
}
while (products.length < 100) {
  const randomIngredientId =
    ingredientIds[Math.floor(Math.random() * ingredientIds.length)];
  const randomTier = ["budget", "standard", "premium"][
    Math.floor(Math.random() * 3)
  ] as "budget" | "standard" | "premium";
  products.push(
    generateProduct(randomIngredientId, products.length, randomTier)
  );
}
